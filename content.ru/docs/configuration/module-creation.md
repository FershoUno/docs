---
title: Создание модулей
type: docs
weight: 3
---

# Создание модулей

Для создания модулей в MiniOS предназначено достаточно большое количество утилит. Все они рассчитаны на использование терминала.

<!--more-->

Для создания модулей в MiniOS предназначено достаточно большое количество утилит. Все они рассчитаны на использование терминала.

**apt2sb** - устанавливает пакеты из репозиториев и упаковывает их в модуль.<br>
**scr2sb**- выполняет действия, описанные в скрипте, и упаковывает результат в модуль.<br>
**upg2sb** - устанавливает обновления из репозиториев и упаковывает их в модуль.<br>
**minios-modules** - выполняет действия, описанные в одном или нескольких скриптах, и упаковывает результат в модуль. Работает аналогично системе сборки minios-live, рассчитан на пакетную сборку нескольких модулей.
В данной статье мы рассмотрим только первые три утилиты, так как они значительно проще в использовании, чем minios-modules.

## **apt2sb**
Для сборки модуля с помощью apt2sb достаточно просто перечислить список пакетов, которые вы хотите упаковать в модуль, например, apt2sb chromium chromium-sandbox. В результате выполнения этой команды в папке, в которой была запущена команда, мы получим модуль chromium.sb, который будет содержать браузер Chromium. Этот модуль будет собран относительно всех модулей, которые загружены в систему, а значит будет требовать наличия их всех для запуска, так как библиотеки, необходимые для работы программы, могут быть уже установлены в системе и могут содержаться в нижних модулях. 

Используя опцию `-l`/`--level` мы можем указать, на базе какого верхнего модуля нам нужно собрать наш модуль. Например, команда `apt2sb -l 4 chromium chromium-sandbox` отфильтрует все модули, имеющие номер 04 и выше при сборке, то есть модуль будет собран на базе модулей с номерами 00-03. В результате выполнения этой команды мы получим модуль 04-chromium.sb в папке, из которой выполнялась команда. Этот модуль будет иметь больше размер, чем пакет в предыдущем примере, так как будет включать в себя все библиотеки, необходимые для запуска программы, которые могли содержаться в модулях с номерами 04 и выше, но зато он сможет запускаться как при наличии модулей с номерами 04-xx, так и при их отсутствии.

Имя модуля создаётся автоматически, на основании имени первого указанного пакета (в нашем случае, chromium) и, если указана опция --level, номере уровня. В случае, если вы хотите самостоятельно задать имя модуля, вы можете использовать опцию `-f`/`--file`, например, `apt2sb -l 4 chromium chromium-sandbox -f 10-browser.sb`.

## **scr2sb**
Для сборки модуля с помощью scr2sb вам необходимо написать скрипт на bash, в котором будут описаны действия, необходимые для сборки вашего модуля. Это может пригодиться в том случае, если перед установкой или после её окончания нужно выполнить какие-то действия в файловой системе, импортировать ключи, добавить репозиторий и т.д.. Вот пример подобного скрипта:
```
#!/bin/bash
# Установка ключей для доступа к репозиторию Debian и дополнения apt для доступа к репозиторию через https
apt install -y debian-keyring debian-archive-keyring apt-transport-https

# Добавление ключа GPG для репозитория Caddy
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg

# Добавление репозитория Caddy в список источников пакетов
curl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' | tee /etc/apt/sources.list.d/caddy-stable.list

# Обновление списка пакетов
apt update

# Установка Caddy
apt install caddy

# Удаление ключей для доступа к репозиторию Debian
apt remove -y debian-keyring debian-archive-keyring apt-transport-https

# Удаление файла списка источников и ключа GPG для репозитория Caddy
rm /etc/apt/sources.list.d/caddy-stable.list /usr/share/keyrings/caddy-stable-archive-keyring.gpg
```
Для запуска сборки по этому скрипту (назовём его caddy.sh) необходимо выполнить команду `scr2sb -s ./caddy.sh`.

Дополнительно, вы можете добавить опции `-l`/`--level` и `-f`/`--file` для указания уровня фильтра модулей и имени модуля  (более подробно назначение опции фильтра модулей описано в описании **apt2sb**). Если имя модуля не указано, то имя создаётся на основании номера уровня, если он указан, и имени скрипта. Пример выполнения команды с использованием этих опций: `scr2sb -s ./caddy.sh -l 1 -f 01-caddy.sb`

Помимо этих опций, вы можете использовать опцию `-d`/`--directory`. Если указана эта опция, то содержимое папки, которая будет указана аргументом опции, будет скопировано в корень модуля перед началом выполнения скрипта. Файлы в такой папке необходимо располагать так, как они располагались бы в корневой папке системы. Допустим, вам надо разместить ярлык для какой-нибудь программы в меню, тогда создадим папку mymodule и создадим в ней структуру относительно корня системы:
```
mkdir -p /home/user/mymodule/usr/share/applications
```
В папку mymodule/usr/share/applications необходимо положить файл desktop, который будет упакован в модуль после окончания сборки, и запустить команду сборки:
```
scr2sb -s ./caddy.sh -l 1 -f 01-caddy.sb -d /home/user/mymodule
```

## **upg2sb**
Утилита upg2sb служит для загрузки обновлений системы и упаковки их в модуль. Как и в apt2sb и scr2sb вы можете использовать опции `-l`/`--level` и `-f`/`--file` для указания уровня фильтра модулей и имени модуля  (более подробно назначение опции фильтра модулей описано в описании apt2sb). По умолчанию, если не указаны опции, создаётся модуль с именем 10-upgrade-230819.sb, где 230819 - текущая дата в формате ГГММДД. Если указана опция `-l`/`--level`, то номер уровня фильтра будет использован в имени модуля, например, при запуске команды `upg2sb -l 4` будет создан модуль с именем 04-upgrade-230819.sb.
